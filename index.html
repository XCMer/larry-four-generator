<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Larry Four by XCMer</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Larry Four</h1>
        <p class="header">Laravel Four Generator</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/XCMer/larry-four-generator/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/XCMer/larry-four-generator/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/XCMer/larry-four-generator">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/XCMer">XCMer</a></p>


      </header>
      <section>
        <p>If you are not already familiar, I had released a generator for Laravel called <a href="https://github.com/XCMer/larry-laravel-generator">Larry</a>. This version is intended to work with Laravel 4, while supporting new features like polymorphic relations.</p>

<p>Larry Four has been re-written from scratch for Laravel 4. We have a better syntax that allows more flexibility and room for adding in more features.</p>

<p><strong>Current Version:</strong> 1.0.1 (stable)</p>

<h2>
<a name="a-birds-eye-view" class="anchor" href="#a-birds-eye-view"><span class="octicon octicon-link"></span></a>A bird's eye view</h2>

<p>Here's how an input to larry would look:</p>

<pre><code>User users; hm Post; mo Image imageable; btm Role;
    id increments
    timestamps
    username string 50; default "hello world"; nullable;
    password string 64
    email string 250
    type enum admin, moderator, user

Post; mm Image imageable;
    timestamps
    title string 250
    content text
    rating decimal 5 2

Image
    filename string

Role
    name string
    level integer
</code></pre>

<p>In the above case, Larry would do the following:</p>

<ul>
<li>Create migration files for all the tables required, along with all the columns. Larry automatically figures out which foreign key columns to add, depending on the relations you define. Pivot table in case of belongsToMany relation is also automatically created.</li>
<li>Create model files for all the models defined. These models also have relational functions automatically defined in them.</li>
</ul><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>You can visit <a href="https://packagist.org/packages/raahul/larryfour">Packagist</a> to check the latest version of Larry Four. Currently, it is <code>1.0.1</code>.</p>

<p>Here are the steps:</p>

<ul>
<li>Put the following in your composer.json: <code>"raahul/larryfour": "1.*"</code>
</li>
<li>Run <code>composer update</code>
</li>
<li>Add <code>'Raahul\LarryFour\LarryFourServiceProvider'</code> to the <code>providers</code> array of <code>app/config/app.php</code>
</li>
</ul><h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Once you've successfully installed Larry Four, its commands should be accessible via <code>artisan</code>. You can always type just <code>php artisan</code> to see all available commands, and those available under the <code>larry</code> namespace.</p>

<p>Larry Four supports <strong>four commands.</strong></p>

<pre><code>php artisan larry:generate &lt;input_file&gt;
</code></pre>

<p>The above command takes <code>&lt;input_file&gt;</code> as the input, and generates models and migrations based on that. You have to provide a filename that exists at the root of your Laravel 4 installation, wherein artisan itself resides.</p>

<p>You cannot provide absolute paths for the input file yet. If you're providing a relative path instead of a filename, then it is relative to Laravel's root directory (or basepath).</p>

<p>There are two other commands:</p>

<pre><code>// Generate only migrations, not models
php artisan larry:migrations &lt;input_file&gt;

// Generate only models, not migrations
php artisan larry:models &lt;input_file&gt;
</code></pre>

<h3>
<a name="generating-migrations-from-existing-tables" class="anchor" href="#generating-migrations-from-existing-tables"><span class="octicon octicon-link"></span></a>Generating migrations from existing tables</h3>

<p>The fourth command is a bit different, since it allows you to generate migrations from existing tables. Use it as follows:</p>

<pre><code>php artisan larry:fromdb
</code></pre>

<p>By default, it will pick up all the tables in the database (except the Laravel migration table). Larry Four will always show you a list of tables that will be processed and ask you for a confirmation.</p>

<p>The tables that Larry processes can be altered by specifying the <code>only</code> and <code>except</code> options to the command.</p>

<pre><code>// This will process only the tables 'users' and 'posts'
php artisan larry:fromdb --only=users,posts

// This will process all tables except users and posts
php artisan larry:fromdb --except=users,posts
</code></pre>

<p>Again, you'll get to confirm your selection before the migrations are generated.</p>

<p>Larry Four is intelligent, in that it can distinguish booleans from other tinyints, and increments from a normal unsigned integer.</p>

<p>Be aware that your tables need to have a integer primary key. If it is not found, the migration would automatically contain an <code>id</code> field.</p>

<h2>
<a name="syntax-reference" class="anchor" href="#syntax-reference"><span class="octicon octicon-link"></span></a>Syntax reference</h2>

<p>Create a new text file at the root of your Laravel installation, and you can name it anything you want. The input file basically defines the following things:</p>

<ul>
<li>All the models that should be created</li>
<li>The relationship between those models</li>
<li>The fields inside each of those models</li>
<li>Modifiers to the fields like default values, nullable/unsigned, and indices</li>
</ul><p>All the models get an auto-incrementing primary key called <code>id</code>. You can override the name of the primary key. All foreign keys created are unsigned.</p>

<p>Larry provides ways to override foreign key and pivot table names as well. These are optional. By default, Larry follows the same convention as Laravel for naming tables, pivot tables, and foreign keys.</p>

<p>Finally, Larry ignores blank lines (even if they contain whitespace). So, you're free to beautify the looks of your input.</p>

<p>Now, let's begin with the syntax.</p>

<h3>
<a name="model-definition" class="anchor" href="#model-definition"><span class="octicon octicon-link"></span></a>Model definition</h3>

<p>Model definition is how you tell Larry about a new model that has to be created. Since fields need a model to be added to, a model definition will be the first logical line of your input file.</p>

<p>When defining a new model, the line <strong>should not</strong> be indented by any amount of whitespace.</p>

<p>The most simple model definition would look like this:</p>

<pre><code>User
</code></pre>

<p>All models will automatically get an <code>id</code> field of type <code>increments</code>. Apart from just defining the model, you can also define relations between models on this line.</p>

<pre><code>User users; hm Post; mo Image imageable; btm Role;
</code></pre>

<p>In the above case, we specify the relation that the user has with the other models. The types of the relations supported are:</p>

<pre><code>hm: hasMany
ho: hasOne
btm: belongToMany
btmc: belongsToMany with custom pivot table
mm: morphMany
mo: morphOne
</code></pre>

<p>Notice that you can't specify <code>belongsTo</code> and <code>morphTo</code> relations. They are added automatically to the concerned model when their inverses, <code>hasMany, hasOne, morphMany, morphOne</code>, are specified in a related model.</p>

<p>The <code>belongsToMany</code> with custom pivot table is covered in the section: "Creating orphan tables"</p>

<h4>
<a name="semicolons" class="anchor" href="#semicolons"><span class="octicon octicon-link"></span></a>Semicolons</h4>

<p>When defining related models, each definition is delimited by a semicolon. The final semicolon is optional.</p>

<h4>
<a name="overriding-table-name" class="anchor" href="#overriding-table-name"><span class="octicon octicon-link"></span></a>Overriding table name</h4>

<p>You can override the table name of the current model by simply adding it after the model name.</p>

<pre><code>User my_users; hm Post
</code></pre>

<p>The generated model and migration will take this into account.</p>

<h4>
<a name="overriding-foreign-key-and-pivot-table-names" class="anchor" href="#overriding-foreign-key-and-pivot-table-names"><span class="octicon octicon-link"></span></a>Overriding foreign key and pivot table names</h4>

<p>While specifying relations above, you can override the foreign key used. This can be done as:</p>

<pre><code>User; hm Post my_user_id;
</code></pre>

<p>In the above case, the foreign key <code>my_user_id</code> will be used instead of the conventional <code>user_id</code>. Larry takes care of the naming in the migrations, as well as overriding the default foreign key in the model's relation function.</p>

<p>In case of <code>belongsToMany</code>, you can override the pivot table name:</p>

<pre><code>// pivot table will be named "r_u" instead of the
// conventional role_user
User; btm Role r_u;
</code></pre>

<p>And also the foreign keys inside the pivot table:</p>

<pre><code>// foreign keys are named "u_id" &amp; "r_id" instead of
// the conventional "user_id" &amp; "role_id"
User; btm Role r_u u_id r_id;
</code></pre>

<p>For polymorphic relations (<code>morphOne</code> and <code>morphMany</code>), it is mandatory to specify a second paramater to the relation, indicating the name of the polymorphic function:</p>

<pre><code>User; mm Image imageable;
</code></pre>

<h3>
<a name="field-definition" class="anchor" href="#field-definition"><span class="octicon octicon-link"></span></a>Field definition</h3>

<p>After you define a model, you need to define fields for it.</p>

<pre><code>User users; hm Post; mo Image imageable;
    id increments
    timestamps
    username string 50; default "hello world"; nullable;
    password string 64
    email string 250
    type enum admin, moderator, user
    softDeletes
</code></pre>

<p>Looking above, you'll get a good idea of how fields are defined. The syntax is as follows:</p>

<pre><code>&lt;field_name&gt; &lt;field_type&gt; &lt;field_parameters&gt;; &lt;field_modifier&gt;; &lt;field_modifier&gt; ...
</code></pre>

<ul>
<li>The <code>&lt;field_name&gt;</code> is simply the column name.</li>
<li>The <code>&lt;field_type&gt;</code> is any of the field types supported by Laravel.</li>
<li>
<code>&lt;field_parameters&gt;</code> are additional parameters to a field function, like length of a string.</li>
<li>
<code>&lt;field_modifier&gt;</code> includes default, nullable, unsigned , and indices. Multiple field modifiers can be specified for a field.</li>
</ul><p><strong>Below are certain points to note:</strong></p>

<p>The <code>increments</code> field is optional, and you should have a need to specify it only if you want your auto-incrementing field to be named differently from <code>id</code>.</p>

<p>The <code>timestamps</code> and <code>softDeletes</code> fields are special, for they have no field name. By default, timestamps and softDeletes are disabled in all the models, and migrations don't create columns for them. By adding either of them as a field, you enable them for that model, and the migration will contain the necessary columns.</p>

<p>Another field that has a different syntactical nuance is the <code>enum</code> field. The parameters to the enum fields are separated by commas. They may or may not be individually enclosed in quotes, like:</p>

<pre><code>type enum "admin", "moderator", "user"
OR
type enum admin, moderator, user
</code></pre>

<p>Other types work as expected, and have syntax similar to the <code>string</code> type you see above.</p>

<p>The following field types are supported:</p>

<pre><code>increments
string
integer
bigInteger
smallInteger
float
decimal
boolean
date
dateTime
time
timestamp (not to be confused with timestamp**s**)
text
binary
enum
softDeletes
</code></pre>

<p>And the following field modifiers are supported:</p>

<pre><code>default "value"
nullable
unsigned
primary
fulltext
unique
index
</code></pre>

<h3>
<a name="creating-orphan-tables" class="anchor" href="#creating-orphan-tables"><span class="octicon octicon-link"></span></a>Creating orphan tables</h3>

<p>Now, Larry also allows you to create tables (or migrations to precise), without creating models and relations for that table. In short, it's a quick way to add in just a table.</p>

<p>This feature is primarily useful in creating custom pivot tables for the <code>btmc</code> relation type. Pivot tables are not associated with any models.</p>

<p>Normally, for <code>btm</code> relations, a pivot table is automatically created for you with the required fields. However, at times, you'd want to have additional fields in your pivot table. In such cases, you should use the <code>btmc</code> relation, and then specify a custom table with all the desired columns.</p>

<p>An example would be:</p>

<pre><code>Post; mm Image imageable; btmc Comment;
    timestamps
    title string 250
    content text
    rating decimal 5 2

table comment_post
    comment_id integer; unsigned
    post_id integer; unsigned
    name string
    type string
    additional fields...
</code></pre>

<p>A Post now belongsToMany comments (unusual). Laravel's convention dictates that the pivot table should be called <code>comment_post</code>, and the fields inside should be <code>comment_id</code> and <code>post_id</code>.</p>

<p>You can override the pivot table name and field names the same way as you did in <code>btm</code>. Just make sure that your custom table reflects it.</p>

<p>Custom tables are defined using the term <code>table &lt;table_name&gt;</code>, as you might have noticed. This is how Larry differentiates whether you want to define a model, or an orphan table.</p>

<p>If you specify additional fields, they will be automatically added to <code>withPivot</code> function in the model's relation:</p>

<pre><code>return $this-&gt;belongsToMany('Comment')-&gt;withPivot('name', 'type');
</code></pre>

<p>If your pivot table contains timestamps, Larry will add them to the relational function too:</p>

<pre><code>return $this-&gt;belongsToMany('Comment')-&gt;withPivot('name', 'type')-&gt;withTimestamps();
</code></pre>

<p><strong>Note:</strong> If you don't create a pivot table with the right name, or the pivot table doesn't contain the necessary columns for a <code>belongsToMany</code> relation, Larry will throw a helpful error. Remember that the foreign keys of a pivot table have to be unsigned integers.</p>

<h2>
<a name="error-handling" class="anchor" href="#error-handling"><span class="octicon octicon-link"></span></a>Error handling</h2>

<p>Larry Four has an improved error handling mechanism. If there are syntax errors in your input file, you will be notified about it along with the line number. The error will tell you exactly what's wrong in plain English.</p>

<p>Currently, Larry can detect the following errors:</p>

<ul>
<li>Typo in relationship types (typing <code>hms</code> instead of <code>hm</code> will yield an error)</li>
<li>Insufficient parameters to relationships or field definitions</li>
<li>Non-existance of a model that was specified as related in another model</li>
<li>Invalid field types</li>
</ul><h2>
<a name="testing" class="anchor" href="#testing"><span class="octicon octicon-link"></span></a>Testing</h2>

<p>The repo contains PHPUnit tests. This should keep the bugs out and also expedite feature releases.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>